// Simple interactive behavior: menu toggle + reveal + background parallax
document.addEventListener('DOMContentLoaded', function(){
  const menuToggle = document.getElementById('menuToggle');
  const mainNav = document.getElementById('mainNav');
  menuToggle && menuToggle.addEventListener('click', () => {
    mainNav.classList.toggle('open');
  });

  // Set year
  const yearEl = document.getElementById('year');
  if(yearEl) yearEl.textContent = new Date().getFullYear();

  // Simple reveal on scroll
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if(entry.isIntersecting) entry.target.classList.add('visible');
    });
  }, {threshold: 0.12});
  document.querySelectorAll('.card, .screenshot, .mock-window, .hero-copy').forEach(el => observer.observe(el));

  // Background parallax effect:
  // Moves the background slightly based on mouse position (subtle) to emulate the LunarClient background motion.
  // Works only if the CSS variable --bg-image points to an existing file (assets/images/background.png).
  (function setupBackgroundParallax() {
    const root = document.documentElement;
    let lastX = 0, lastY = 0, raf = null;

    function onMove(e){
      // Normalize mouse position -0.5..0.5
      const x = (e.clientX / window.innerWidth) - 0.5;
      const y = (e.clientY / window.innerHeight) - 0.5;

      // Scale to px move (small)
      const tx = (-x) * 18; // horizontal movement range
      const ty = (-y) * 12; // vertical movement range

      lastX = `${tx}px`;
      lastY = `${ty}px`;

      if(!raf){
        raf = requestAnimationFrame(() => {
          root.style.setProperty('--bg-x', lastX);
          root.style.setProperty('--bg-y', lastY);
          raf = null;
        });
      }
    }

    // Reduce motion for users who prefer reduced motion
    const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
    if(mq && mq.matches) return;

    // Only attach on pointer-capable devices
    window.addEventListener('pointermove', onMove, {passive:true});

    // Small parallax on scroll too (subtle)
    let lastScroll = window.scrollY;
    window.addEventListener('scroll', () => {
      const s = window.scrollY;
      const delta = (s - lastScroll) * 0.05;
      lastScroll = s;
      // add vertical offset based on scroll (limits)
      const offsetY = Math.max(Math.min(parseFloat(getComputedStyle(root).getPropertyValue('--bg-y')) || 0, 100), -100);
      root.style.setProperty('--bg-y', `calc(${offsetY}px - ${delta}px)`);
    }, {passive:true});
  })();
});
